<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Multi Game Platform</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
      }
      #lobby, #game-container {
        display: none;
        margin-top: 20px;
        border: 1px solid #ccc;
        padding: 20px;
        border-radius: 5px;
      }
      input, button, select {
        padding: 8px;
        margin: 5px 0;
      }
      button {
        cursor: pointer;
      }
      #game-board {
        margin: 20px 0;
      }
      .row {
        display: flex;
      }
      .square {
        width: 60px;
        height: 60px;
        border: 1px solid #000;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 24px;
        cursor: pointer;
      }
      .room-item {
        margin: 5px 0;
        padding: 5px;
        background: #f0f0f0;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <div id="login-section">
      <h2>Login</h2>
      <input type="text" id="username" placeholder="Username" />
      <button id="login-btn">Login</button>
    </div>
    
    <div id="lobby">
      <h2>Game Lobby</h2>
      <div>
        <select id="game-select">
          <option value="tictactoe">Tic Tac Toe</option>
          <option value="simple-rpg">Simple RPG</option>
        </select>
        <button id="create-room-btn">Create Room</button>
      </div>
      <h3>Available Rooms</h3>
      <ul id="room-list"></ul>
    </div>
    
    <div id="game-container">
      <h2 id="game-title"></h2>
      <div id="game-board"></div>
      <div id="game-status"></div>
      <button id="return-to-lobby" style="margin-top: 20px;">Return to Lobby</button>
    </div>
    
    <script>
      const API_GATEWAY_URL = "http://localhost:8080";
      
      // DOM elements
      const elements = {
        username: document.getElementById("username"),
        loginBtn: document.getElementById("login-btn"),
        lobby: document.getElementById("lobby"),
        gameSelect: document.getElementById("game-select"),
        createRoomBtn: document.getElementById("create-room-btn"),
        roomList: document.getElementById("room-list"),
        gameContainer: document.getElementById("game-container"),
        gameTitle: document.getElementById("game-title"),
        gameBoard: document.getElementById("game-board"),
        gameStatus: document.getElementById("game-status"),
        returnToLobby: document.getElementById("return-to-lobby")
      };
      
      // Current game state
      let currentGame = null;
      let currentUser = null;
      
      // Initialize the app
      function init() {
        // Hide lobby and game container initially
        elements.lobby.style.display = "none";
        elements.gameContainer.style.display = "none";
        
        // Set up event listeners
        elements.loginBtn.addEventListener("click", handleLogin);
        elements.createRoomBtn.addEventListener("click", handleCreateRoom);
        elements.returnToLobby.addEventListener("click", returnToLobby);
      }
      
      // Login handler
      function handleLogin() {
        const username = elements.username.value.trim();
        if (username) {
          currentUser = username;
          elements.lobby.style.display = "block";
          elements.username.value = "";
          // TODO: Send login to server
          fetchRooms();
        } else {
          alert("Please enter a username");
        }
      }
      
      // Create room handler
      function handleCreateRoom() {
        const gameType = elements.gameSelect.value;
        // TODO: Send create room request to server
        startGame(gameType);
      }
      
      // Fetch available rooms
      function fetchRooms() {
        // TODO: Implement API call to get rooms
        // Mock data for now
        const mockRooms = [
          { id: "room1", game: "tictactoe", players: 1 },
          { id: "room2", game: "simple-rpg", players: 2 }
        ];
        
        updateRoomList(mockRooms);
      }
      
      // Update room list UI
      function updateRoomList(rooms) {
        elements.roomList.innerHTML = "";
        rooms.forEach(room => {
          const li = document.createElement("li");
          li.className = "room-item";
          li.textContent = `${room.game} (${room.players}/2)`;
          li.addEventListener("click", () => joinRoom(room.id));
          elements.roomList.appendChild(li);
        });
      }
      
      // Join room handler
      function joinRoom(roomId) {
        // TODO: Implement API call to join room
        const gameType = elements.gameSelect.value; // This should come from room data
        startGame(gameType);
      }
      
      // Start a game
      function startGame(gameType) {
        elements.lobby.style.display = "none";
        elements.gameContainer.style.display = "block";
        
        switch(gameType) {
          case "tictactoe":
            tictactoeStart();
            break;
          case "simple-rpg":
            simpleRpgStart();
            break;
          default:
            console.error("Unknown game type");
        }
      }
      
      // Return to lobby
      function returnToLobby() {
        elements.gameContainer.style.display = "none";
        elements.lobby.style.display = "block";
        currentGame = null;
        fetchRooms();
      }
      
      // Tic Tac Toe implementation
      function tictactoeStart() {
        currentGame = "tictactoe";
        elements.gameTitle.innerText = "Tic Tac Toe";
        elements.gameBoard.innerHTML = `
          <div class="row">
            <div class="col"><div class="square" data-index="0"></div></div>
            <div class="col"><div class="square" data-index="1"></div></div>
            <div class="col"><div class="square" data-index="2"></div></div>
          </div>
          <div class="row">
            <div class="col"><div class="square" data-index="3"></div></div>
            <div class="col"><div class="square" data-index="4"></div></div>
            <div class="col"><div class="square" data-index="5"></div></div>
          </div>
          <div class="row">
            <div class="col"><div class="square" data-index="6"></div></div>
            <div class="col"><div class="square" data-index="7"></div></div>
            <div class="col"><div class="square" data-index="8"></div></div>
          </div>`;
        
        elements.gameStatus.innerHTML = "Your turn (X)";
        
        // Add event listeners to squares
        document.querySelectorAll(".square").forEach(square => {
          square.addEventListener("click", handleTicTacToeMove);
        });
      }
      
      function handleTicTacToeMove(e) {
        const square = e.target;
        if (!square.textContent) {
          square.textContent = "X"; // TODO: Should be based on player turn
          // TODO: Send move to server
          checkTicTacToeGameStatus();
        }
      }
      
      function checkTicTacToeGameStatus() {
        // TODO: Implement game logic
        // This is just a placeholder
        elements.gameStatus.textContent = "Waiting for opponent...";
      }
      
      // Simple RPG implementation (placeholder)
      function simpleRpgStart() {
        currentGame = "simple-rpg";
        elements.gameTitle.innerText = "Simple RPG";
        elements.gameBoard.innerHTML = `
          <div>
            <p>Simple RPG game will be here</p>
            <button id="rpg-action">Attack</button>
          </div>`;
        
        // TODO: Add RPG game logic
        document.getElementById("rpg-action").addEventListener("click", () => {
          alert("Attack!");
        });
      }
      
      // Initialize the application
      init();
    </script>
  </body>
</html>